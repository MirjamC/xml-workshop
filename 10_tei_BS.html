
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>10. Practical session: Tei and Beautiful Soup &#8212; Automatically extract XML content with Python</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11. Practical session: Page and Beautiful Soup" href="11_page_BS.html" />
    <link rel="prev" title="9. Practical session: Alto and Beautiful Soup" href="9_alto_BS.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Automatically extract XML content with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to this XML course
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1_introduction_python.html">
   1. Introduction to Python and Jupyter Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2_introduction_xml.html">
   2. Introduction to XML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3_introduction_packages.html">
   3. Introduction to the packages ElemenTree and Beautiful Soup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4_example_ET.html">
   4. Practical session: Working with ElemenTree
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5_example_BS.html">
   5. Practical session: Working with Beautiful Soup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6_xmlformats_intro.html">
   6. Introduction to the Alto/Didle, TEI and Page format
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7_alto_ET.html">
   7. Practical: Extract information from the Alto format with ElemenTree
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8_page_ET.html">
   8. Practical session: Page and Elementree
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9_alto_BS.html">
   9. Practical session: Alto and Beautiful Soup
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   10. Practical session: Tei and Beautiful Soup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_page_BS.html">
   11. Practical session: Page and Beautiful Soup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_auto_batch.html">
   12. Practical session: Automatically extract information from a batch of files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="end.html">
   End of course
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/10_tei_BS.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/10_tei_BS.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/xml-workshop"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/xml-workshop/issues/new?title=Issue%20on%20page%20%2F10_tei_BS.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/xml-workshop/master?urlpath=tree/docs/10_tei_BS.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#voorbeeld-toevoegen">
   voorbeeld toevoegen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dividing-the-text-in-chapters">
   Dividing the text in chapters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-chapters-to-disk">
   Saving the chapters to disk
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-poems">
   Extracting Poems
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>10. Practical session: Tei and Beautiful Soup</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#voorbeeld-toevoegen">
   voorbeeld toevoegen
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dividing-the-text-in-chapters">
   Dividing the text in chapters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-chapters-to-disk">
   Saving the chapters to disk
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-poems">
   Extracting Poems
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="practical-session-tei-and-beautiful-soup">
<h1>10. Practical session: Tei and Beautiful Soup<a class="headerlink" href="#practical-session-tei-and-beautiful-soup" title="Permalink to this headline">¶</a></h1>
<p>For this session we will extract data from TEI format. We will only extract information from TEI using Beautifull Soup as ElementTree does not handle spaces (&amp;nbsp) well.</p>
<p>When working with TEI format it is very important to check the lay-out. This can vary a lot between files.</p>
<p>Open a new Jupyter Notebook and type all code examples and code exercises in your Notebook. (see explanation in ET:import)</p>
<div class="section" id="voorbeeld-toevoegen">
<h2>voorbeeld toevoegen<a class="headerlink" href="#voorbeeld-toevoegen" title="Permalink to this headline">¶</a></h2>
<p>Opletten: teis kunnen erg verschillen van opmaak
##(voorbeeld van een TEI waarin de text in een p staat of in een l).</p>
<p>As you can see in the example, it is wise to <strong>always</strong> check which elements you need to ensure you extract the correct data.
TEI files of the same kind, for example all about one poet, usually are similar. However, double-checking this can save a lot of work (and frustration) later on.
Let’s start with importing Beautifull Soup and loading the XML file.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Import Beautifull Soup and load the XML file into a variable.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>    

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;xml-workshop/data/tei.xml&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We are now all clear to start exploring the XLM file. As always we should first explore the structure.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Check the structure of the data.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>We can check the structure of the loaded file by simply running the variable it is stored in.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
</pre></div>
</div>
</div>
<div class="cell tag_remove-input tag_hide-output docutils container">
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>    
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;xml-workshop/data/tei.xml&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">root</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">root</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;xml-workshop/data/tei.xml&#39;
</pre></div>
</div>
</div>
</div>
<p>This TEI file contains information of a book. It has multiple elements containing data about the book and the content of the book. We will need to read teh structure carefully to find the right elements where the content we want is stored.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>In which elements can you find the main content, the text, of this book?
Is the content present as a value or as an attribute?</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>The content is contained in the elements <em>title</em>, <em>head</em>, <em>l</em>, and <em>p</em>.</p>
</div>
<p>There are a lot of elements containing the data. One option is to print the whole XML. This way no content will be missed and all possible text is extracted. This can be done with:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
</div>
<p>A downside of this option is that a lot of metadata is printed out as well. Usually you would not want to have the metadata within the content. Filtering this out afterwards is very work-intensive.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Can you think of a way to structure the text in a more logical manner?</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>One option would be to print it out per chapter.</p>
</div>
</div>
<div class="section" id="dividing-the-text-in-chapters">
<h2>Dividing the text in chapters<a class="headerlink" href="#dividing-the-text-in-chapters" title="Permalink to this headline">¶</a></h2>
<p>It is possible to iterate through the root and collect all the <em>div</em> elements with as type <em>chapter</em>. When all the chapters are collected it is then possible to print all <em>.text</em> content contained in these <em>div</em>s.
Using a <em>for loop</em> is a good start. This will iterate through the divs one by one. Within the loop we can perform the different actions, like extraction and transformation.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Construct a <em>for loop</em> that goes through the divs and prints out all content of the divs with <em>type</em> ‘chapter’</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>One option would be to print it out per chapter.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1">## the for loop iterates through every div </span>
<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">):</span>
	<span class="c1">## all actions within the loop are performed div by div.</span>
	<span class="c1">## here we select only divs with type chapter</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;chapter&#39;</span><span class="p">:</span>
		<span class="c1">## and we print the div</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell tag_remove-input tag_hide-output docutils container">
</div>
<p>The code still prints out everything as a single piece of text without anything to distinguish the different chapters. Adding a chapter header is an easy way to be able to seperate the different chapters.
This can be done by making a counter and printer the text ‘chapter [counter]’ before every chapter. After every <em>div</em> that the code iterates through the counter is raised by one, so every chapter gets a distinguishing number.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1">## initialise the counter at 1</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;chapter&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chapter &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
		<span class="c1">## add 1 to the counter every iteration of the loop</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Try the code above to see how the output now contains increasing chapter count</p>
<div class="cell tag_remove-input tag_hide-output docutils container">
</div>
<p>Great! we now have all the chapters in order, and numbered. However, this is not the most readable output.</p>
</div>
<div class="section" id="saving-the-chapters-to-disk">
<h2>Saving the chapters to disk<a class="headerlink" href="#saving-the-chapters-to-disk" title="Permalink to this headline">¶</a></h2>
<p>Printing to the output is great for prototyping, but to make sure the extracted data can be used for further analysis and to keep the workspace a bit uncluttered it is best to save the extracted content to file. This can be done chapter for chapter or by creating one larger file containting a chapter per row.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Expand the code so it saves the extracted chapters as seperate text files, using the chapter name and number as file name.
Hint: do you remember f strings?</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;chapter&#39;</span><span class="p">:</span>
        <span class="n">chapter</span> <span class="o">=</span> <span class="s2">&quot;chapter_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">chapter</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<p>Now we have a lot of text files. Each one containing one chapter of the book . For some uses this may be preferable, but for other a single, ordered file may be preferred.
In the next exercises we will write code that will store the chapters in an ordered format in a single file.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>If you recall, it is also possible to save the data as .csv.<br />
What are the easiest steps to do this?</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<ol class="simple">
<li><p>Saving the content in a list</p></li>
<li><p>Transforming into a Pandas Dataframe</p></li>
<li><p>Save the DataFrame to .csv</p></li>
</ol>
</div>
<p>Having refreshed our memory we will now put it into practice.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Change the code to store the chapter and content in a list. Note that this will create one long list with all the extracted content.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">chapter_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;chapter&#39;</span><span class="p">:</span>
        <span class="n">chapter</span> <span class="o">=</span> <span class="s2">&quot;chapter_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">text</span>
        <span class="n">chapter_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">chapter</span><span class="p">,</span> <span class="n">content</span><span class="p">])</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<p>With the first step done the list can now be transformed into a Dataframe. Don’t forget to think about the order of the list content and the Dataframe columns.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Transform the list into a Dataframe.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">book</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">chapter_list</span> <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;chapter&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>It is good practice to check what you transformed, so print out the dataframe.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>book
</pre></div>
</div>
</div>
<p>If the Dataframe is in order we can save the Datframe directly to file.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Save the Dataframe to csv.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">chapters</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;chapters.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember that this saves the csv in the root folder of your jupyter installation. If you want it saved in a specific location you need to specify the path before the filename followed by a /.</p>
</div>
</div>
<div class="section" id="extracting-poems">
<h2>Extracting Poems<a class="headerlink" href="#extracting-poems" title="Permalink to this headline">¶</a></h2>
<p>For some uses only a specific pieces of an XML is needed. Extracting everything and then either removing or ignoring part of the extracted content is a lot of work that can be omitted by specifically extracting what is needed.
The example TEI file contains a book that consists of both pieces of prose and poems. Both of these are specified somewhere in the XML. Over the coming exercises we will extract only the poems. To do this we need to know which elements indicate contain the poems.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Check the file to see which elements are needed to extract the poems from the file.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>To extract the poems the element <strong>lg</strong> with type <strong>poems</strong> is needed.</p>
</div>
<p>Having found the elements with the poems, we will now need to extract them from the XML.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Write a piece of code that extracts and prints all the poems from the file. You can look at the previous exercises for hints.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;lg&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;poem&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As we did in the previous exercises where we extracted the whole chapters, we will save the extracted poems as seperate, and numbered, files.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Expand the code of the previous exercise to include a counter for numbering the poems, and saving the poems one by one. As with the previous exercises use ‘poem + counter’ or something similar as a filename.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;lg&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;poem&#39;</span><span class="p">:</span>
        <span class="n">poem</span> <span class="o">=</span> <span class="s2">&quot;poem_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">poem</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
            <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">div</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<p>Again, we now have many seperate files. But we will also want to create a single file containing the poems in a structured manner.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Adapt the code above to save the extracted poems to a single csv. If you feel lost, just go back a few exercises and look at what we did there. Remember, first list, then dataframe.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">poem_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;lg&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;poem&#39;</span><span class="p">:</span>
        <span class="n">poem</span> <span class="o">=</span> <span class="s2">&quot;poem_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">text</span>
        <span class="n">poem_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">poem</span><span class="p">,</span> <span class="n">content</span><span class="p">])</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">poems</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">poem_list</span> <span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;poem&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">]))</span>

<span class="n">poems</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;poems.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This should create a file in your Jupyter home folder containing all all the numbered poems.</p>
<p>The next exercise is a bit more challenging.</p>
<div class="attention admonition">
<p class="admonition-title">Exercise</p>
<p>Create a Dataframe containing all the (numbered) chapters and poems:</p>
<ul class="simple">
<li><p>The chapters must be numbered consecutively</p></li>
<li><p>The poems must be numbered consecutively per chapter</p></li>
</ul>
<p>This means that you will need to extract chapter information from the XML, in addition to the poem information. Also, something to number the chapters is needed.</p>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>You code should look similar to the code below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">chapter_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">c_counter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p_counter</span> <span class="o">=</span> <span class="mi">1</span> 
	<span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">div</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;chapter&#39;</span><span class="p">:</span>
			<span class="n">chapter</span> <span class="o">=</span> <span class="s2">&quot;chapter_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c_counter</span><span class="p">)</span>
			<span class="n">content</span> <span class="o">=</span> <span class="n">div</span><span class="o">.</span><span class="n">text</span>
			<span class="k">for</span> <span class="n">poems</span> <span class="ow">in</span> <span class="n">div</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;lg&#39;</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">poems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;poem&#39;</span><span class="p">:</span>
				<span class="n">poem</span> <span class="o">=</span> <span class="s2">&quot;poem_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p_couter</span><span class="p">)</span>
				<span class="n">p_content</span> <span class="o">=</span> <span class="n">poems</span><span class="o">.</span><span class="n">text</span>
				<span class="n">chapter_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chapter</span><span class="p">,</span> <span class="n">poem</span><span class="p">,</span> <span class="n">p_content</span><span class="p">])</span>
				<span class="n">p_counter</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="n">c_counter</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="n">p_counter</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">poems</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">chapter_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">{[</span><span class="s1">&#39;chapter&#39;</span><span class="p">,</span> <span class="s1">&#39;poem&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell tag_remove-input tag_hide-output docutils container">
</div>
<p>As you can see we now have the poems numbered per chapter, and each chapters nicely numbered as well. This Datarfame will make a nice and ordered dataset for further analysis or presentation.</p>
<p>Having extracted different types of content and saving them to text and csv, we could, for example, use these for further analyses. Remember that saving files without specifying a pathname saves them to the root folder of Jupyter. This folder might clutter up quickly and it is wise to clean it up regularly or keep it clean by specifying a pathname to a specific folder.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="9_alto_BS.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">9. Practical session: Alto and Beautiful Soup</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="11_page_BS.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">11. Practical session: Page and Beautiful Soup</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Mirjam Cuper & Ethan den Boer<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>